var Widget=function(e){var i=window.br_util;return this.preview=e.preview,this.widget_type=e.widget_type,this.publisher_id=e.user_id,this.widget_id=e.widget_id,this.playerId=e.br_id,this.shown=!1,this.pageUrl=e.pageUrl,this.domain=e.domain,this.ad_id=e.ad_id,this.player=e.player.toLowerCase(),this.isLoop=void 0!=e.is_loop?e.is_loop:void 0!=e.repeat?e.repeat:!1,this.repeatCounter=void 0!=e.repeat_counter&&e.repeat_counter>0?e.repeat_counter:!1,this.backgroundColor=void 0!=e.background_color?e.background_color:"#000000",this.ads=e.ads&&e.ads.length>0?e.ads:null,this.adsType="vast",this.blankVideo=e.blankVideo,this.mute=void 0!==e.mute?e.mute:void 0!==e.is_mute?e.is_mute:!1,this.src=e.src?e.src:!1,this.org_url=e.org_url,this.js_cdn_url=e.js_cdn_url,this.playlist=this.org_url+"/esVideo.php?dn="+e.domain+"&wid="+e.widget_id+"&sid="+e.user_id+"&ad="+this.ad_id+(void 0!==e.playlist_id?"&pid="+e.playlist_id:void 0!==e.video_id?"&vid="+e.video_id:""),i.isHTML5VideoSupported()&&i.isVideoFormatMP4Supported()||"jw"==this.player?(this.is_network_widget=void 0!==e.is_network_widget?e.is_network_widget:!1,this.autostart=void 0!==e.autostart?e.autostart:void 0!==e.is_autoplay?e.is_autoplay:!1,this.autoplay_method=e.autoplay_method||"video_load",this.width=e.width,this.height=e.height,this.macroHeight=void 0!=this.originalHeight?this.originalHeight:this.height,this.macroWidth=void 0!=this.originalWidth?this.originalWidth:this.width,this.muteAds=void 0!=e.muteAds?e.muteAds:!0,this.soundtrapAds=void 0!=e.soundtrapAds?e.soundtrapAds:!0,this.protocol=e.protocol,this.pixelPath=e.pixelPath,this.vastPath=e.vastPath,this.errorPixelPath=e.errorPixelPath,this.brplayerPath=e.brplayerPath,this.vpaidswfPath=e.vpaidswfPath,this.debugMode="1"==e.debugMode,this.playContentOnPrerollBidding=void 0==e.preroll_method||"content"==e.preroll_method,this.spinnerPrerollTimeoutLength=void 0!=e.preroll_method_seconds?e.preroll_method_seconds:3,this.logPlayerCallback=e.logPlayerCallback,this.isWakeupWidget="wakeup_lightbox"==e.widget_type&&!e.is_iframe,this.biddingMethod=e.bidding_method||"default",this.aggressiveBid=e.is_aggressive,this.userFailResponseHistory=e.user_failure_history,this.userAdStartsHistory=e.user_ad_starts_history,this.fullscreenAvailable=e.is_fullscreen,this.toggleSoundOnHover=e.sound_on_mouse_over,this.skinPath=e.skin_path,this.ip=e.ip||"",this.userAgent=e.user_agent||"",this.widgetFq=e.widgetFq,this.passback=e.passback,this.jwplayer_key=e.jwplayerKey,this.pixels=e.pixels,this.opportunityPixel=i.setPixel.call(this,"op"),this.noContentOpportunityPixel=i.setPixel.call(this,"no_content_op_pixel"),this.contentPixel=i.setPixel.call(this,"cnt"),this.playerLoadPixel=i.setPixel.call(this,"pl"),this.errorPixel=this.errorPixelPath?this.errorPixelPath+"?sid="+e.user_id+"&wid="+e.widget_id+"&err={{error}}&cb="+(new Date).getTime():"",i.isMobile()&&(this.adsEndPoint=e.ads_end_point,this.parserPath=e.parserPath,this.networkWidgetBackgroundPath=e.networkWidgetBackgroundPath,this.mobileBlankVideoId=e.mobileBlankVideoId,this.hasContent=e.hasContent,this.mobileMacros=e.mobileMacros,this.maxAdOpportunities=e.maxAdOpportunities,this.maxAdStarts=e.maxAdStarts,this.lkqdTag=e.lkqd_tag?e.lkqd_tag.replace(/^<script>/,"").replace(/<\/script>$/,"").trim():!1,this.actualSize=e.actualSize),void(this.keepAliveTimeout=setTimeout(function(){i.sendMessage(parent,this.ad_id,!1,"CacheMiss")}.bind(this),36e5))):void i.sendMessage(parent,this.ad_id,!1,"JW")};Widget.prototype.loadVideoPlayer=function(){var e=window.br_util;e.isMobile()?this.onVideoPlayerReady&&this.onVideoPlayerReady():e.loadJSFile(this.brplayerPath,!0,document,function(){this.onVideoPlayerReady&&this.onVideoPlayerReady()}.bind(this))},Widget.prototype.getUUID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Widget.prototype.renderImpression=function(){var e="truvidUUID",i=document.cookie.split(";");this.clientId=!1;for(var t=0;t<i.length;t++){var s=i[t].trim();if(s.startsWith(e)){this.clientId=JSON.parse(s.split("=")[1]).uuid;break}}if(!this.clientId){var o=new Date;this.clientId=this.getUUID(),o.setTime(o.getTime()+36e5),document.cookie=e+"_"+99999999*Math.random()+"="+JSON.stringify({uuid:this.clientId})+"; expires="+o+"; path=/"}switch(this.player){case"br":default:this.renderBRVideoPlayer()}},Widget.prototype.renderBRVideoPlayer=function(){var e=window.br_util;e.getJSONP(this.playlist,function(i){function t(i){e.sendMessage(parent,this.ad_id,!1,"Logger",i)}var s={elemId:"#"+this.advertismentPlaceholder.id,ad_id:this.ad_id,width:this.width,height:this.height,playlist:Object.keys(i.playlist||{}).length>0&&i.data.total>1,autoplay:this.autostart&&"in_stream"==this.widget_type?"video_load"==this.autoplay_method:this.autostart,mute:this.mute,advertising:this.renderAdvertising(),muteAds:this.muteAds,soundtrapAds:this.soundtrapAds,swfPath:this.vpaidswfPath,debugMode:this.debugMode,repeat:this.isLoop,repeatCounter:this.repeatCounter,backgroundColor:this.backgroundColor,opportunityPixel:this.opportunityPixel,noContentOpportunityPixel:this.noContentOpportunityPixel,contentPixel:this.contentPixel,playerLoadPixel:this.playerLoadPixel,protocol:this.protocol,parserEndPoint:this.parserPath,adsCdnEndPoint:this.adsEndPoint,isNetworkWidget:this.is_network_widget,playContentOnPrerollBidding:this.playContentOnPrerollBidding,spinnerPrerollTimeoutLength:this.spinnerPrerollTimeoutLength,logPlayerCallback:this.logPlayerCallback?t.bind(this):null,isWakeupWidget:this.isWakeupWidget,widgetId:this.widget_id,biddingMethod:this.biddingMethod,aggressiveBid:this.aggressiveBid,userFailResponseHistory:this.userFailResponseHistory,userAdStartsHistory:this.userAdStartsHistory,fullscreenAvailable:this.fullscreenAvailable,toggleSoundOnHover:this.toggleSoundOnHover,domain:this.domain,skin:this.skinPath,passbackLength:this.passback?this.passback.length:!1,passbackAdSlots:this.passback?this.passback.ad_slots:!1};if(e.isMobile()&&(s.contentEndPoint=i.data.mobile_base_url,s.contentBaseUrl=i.data.base_url,s.maxAdOpportunities=!1,s.maxAdStarts=!1,s.mobileEnvironment=this.mobileEnvironment,s.mobileOS=this.mobileMacros.os),e.isMobile()&&this.is_network_widget)s.playlist=!1,s.playlistContent=!1,s.src=!1,s.maxAdOpportunities=this.maxAdOpportunities,s.maxAdStarts=this.maxAdStarts,s.network_widget_background_path=this.networkWidgetBackgroundPath;else if(Object.keys(i.playlist||{}).length<=0||e.isMobile()&&!this.hasContent)s.playlist=!1,s.src=this.src?this.src:e.isMobile()?!1:this.blankVideo,s.poster="",s.playlistContent=!1;else if(s.playlist)s.playlistContent=i;else{var o=i.playlist[0];s.poster=i.data.base_url+"images/"+(o.tf?o.tf:o.vf)+"_"+(this.width<400||this.height<300?"1":"2")+".png",s.contentPriceModel=o.pm,s.contentPrice=o.pr,s.contentSubUserId=o.sid,s.contentRevshare=o.rev,s.contentPixels=o.pxl,s.title=o.te,s.description=o.dn,s.contentDuration=o.dur,s.src=i.data.base_url+"video/"+o.vf+"_"+(this.width>479?"480":"240")+"."+(o.ext?o.ext:"mp4"),s.contentCategories=o.cat||[]}if(null!=this.setupParameters&&(s=e.mergeJson(s,this.setupParameters)),!this.shown){var n=function(i){var t=new BranovatePlayer;t.onReady("#"+this.advertismentPlaceholder.id,function(){this.showContentFloater&&this.showContentFloater(),this.onRenderPlayer&&this.onRenderPlayer(),this.SetAutoplayMethod&&this.SetAutoplayMethod(),!this.widgetFq||"in_stream"!=this.widget_type&&"wakeup_lightbox"!=this.widget_type&&this.playContentOnPrerollBidding||window.br_util.setWidgetFqCookie(this.publisher_id,this.widget_id)}.bind(this)),this.playerObj=t,t.onSetupError(function(i){this.preview||this.errorPixel.length>0&&i.indexOf("error.gif")<0&&e.loadJSFile(this.errorPixel.replace("{{error}}",encodeURIComponent(i)),!0,document,function(){})}.bind(this)),s.poster=i,t.setup(s),t.onCacheMiss(function(){e.sendMessage(parent,this.ad_id,!1,"CacheMiss")}.bind(this))}.bind(this);s.playlist||!s.poster||this.width<400||this.height<300||e.isMobile()&&this.is_network_widget?n(s.poster):e.promisePoster(s.poster).then(n)}}.bind(this))},Widget.prototype.renderAdvertising=function(){var e=[],i=window.br_util,t={br:{videoUrl:"[item-file]",cb:"[CACHEBUSTING]",videoTitle:"[item-title]",videoDesc:"[item-description]",videoDuration:"[item-duration]",videoId:"[item-mediaid]"},jw:{videoUrl:"__item-file__",cb:"__random-number__",videoTitle:"__item-title__",videoDesc:"__item-description__",videoDuration:"__item-duration__",videoId:"__item-mediaid__"},videojs:{videoUrl:"",cb:"{random}",videoTitle:"{mediainfo.name}",videoDesc:"{mediainfo.description}",videoDuration:"{mediainfo.duration}",videoId:"{mediainfo.id}"}};if(this.ads&&this.adsType)for(var s=0;s<this.ads.length;s++){var o={};o.type=this.adsType;var n=this.ads[s].offset;if(n?("preroll"==n||"pre"==n?this.ads[s].offset="preroll":("postroll"==n||"post"==n)&&(this.ads[s].offset="postroll"),o.offset=this.ads[s].offset):this.ads[s].slots&&(o.slots=this.ads[s].slots),this.ads[s].demand_type=void 0===this.ads[s].demand_type?void 0:"spotsdk"==this.ads[s].demand_type?"spot":this.ads[s].demand_type,o.tag=this.vastPath+"?ad_id="+this.ad_id+"&tag_id="+this.ads[s].id+"&daily_requests="+(this.ads[s].daily_requests?this.ads[s].daily_requests:0)+"&demand_type="+(this.ads[s].demand_type?this.ads[s].demand_type:"vpaid_flash")+"&daily_adstarts="+(this.ads[s].daily_adstarts?this.ads[s].daily_adstarts:0)+"&videoUrl="+t[this.player].videoUrl+"&height="+this.macroHeight+"&width="+this.macroWidth+"&pageUrl="+encodeURIComponent(this.domain)+"&pageHref="+encodeURIComponent(this.pageUrl)+"&prtclDomain="+encodeURIComponent(document.location.protocol+"//"+this.domain)+"&pageTitle="+encodeURIComponent(document.title)+"&cb="+t[this.player].cb+"&timestamp="+Math.round((new Date).getTime()/1e3)+"&videoTitle="+t[this.player].videoTitle+"&videoDesc="+t[this.player].videoDesc+"&videoDuration="+t[this.player].videoDuration+"&videoId="+t[this.player].videoId+"&cnt_pm=[cnt-pm]&cnt_pr=[cnt-pr]&cnt_sid=[cnt-sid]&cnt_rev=[cnt-rev]&ip="+encodeURIComponent(i.isMobile()?this.mobileMacros.ip:this.ip)+"&userAgent="+encodeURIComponent(i.isMobile()?this.mobileMacros.user_agent:this.userAgent)+"&clientId="+encodeURIComponent(this.clientId||""),i.isMobile()&&(o.tag+="&osPlatform="+encodeURIComponent(this.mobileMacros.os)+"&osVersion="+encodeURIComponent(this.mobileMacros.os_version)+"&dnt=0&location="+encodeURIComponent((this.mobileMacros.geo_location.latitude||"")+","+(this.mobileMacros.geo_location.longitude||""))+"&latitude="+encodeURIComponent(this.mobileMacros.geo_location.latitude||"")+"&longitude="+encodeURIComponent(this.mobileMacros.geo_location.longitude||"")),this.preview&&(o.tag+="&preview=true"),o.demandSourceId=this.ads[s].demand_source_id,o.demandTagId=this.ads[s].demand_tag_id,o.tag_id=this.ads[s].id,o.priority=this.ads[s].priority||5,o.demandType=this.ads[s].demand_type||"vpaid_flash",o.dailyRequests=this.ads[s].daily_requests||0,o.dailyAdstarts=this.ads[s].daily_adstarts||0,o.impressionFq=this.ads[s].impression_frequency||!1,o.priceFloor=this.ads[s].price_floor||0,o.channelId=this.ads[s].channel_id||85394,o.timeout=this.ads[s].timeout||15,e[s]=o,this.ads[s].daily_frequency){for(var r={demand_source_id:o.demandSourceId,demand_tag_id:o.demandTagId,daily_frequency:this.ads[s].daily_frequency},a=document.cookie.split(";"),d=!1,l=0;l<a.length;l++){var h=a[l].trim();if(h.startsWith("truvid_tag")){var p=JSON.parse(h.split("=")[1]);if(p.demand_source_id==o.demandSourceId&&p.demand_tag_id==o.demandTagId){d=!0;break}}}if(!d){var c=new Date,u=new Date(c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2)+" 16:59:59:999 EST");document.cookie="truvid_tag_"+99999999*Math.random()+"="+JSON.stringify(r)+"; expires="+u+"; path=/"}}}return e},Widget.prototype.renderVideoPlayer=function(e){var i=window.br_util;this.advertismentPlaceholder=e,!i.isMobile()||this.fallbackToTruvidMobile?this.renderImpression():this.fallbackToLkqd()},Widget.prototype.fallbackToLkqd=function(){if(this.lkqdTag){var e=document.createElement("script");e.innerHTML=this.lkqdTag,this.advertismentPlaceholder.appendChild(e),this.centerLkqd()}else this.fallbackToTruvidMobile=!0,window.br_util.loadJSFile(this.brplayerPath,!0,document,function(){this.onVideoPlayerReady&&this.onVideoPlayerReady()}.bind(this))},Widget.prototype.centerLkqd=function(){(function e(){setTimeout(function(){for(var i=this.advertismentPlaceholder.getElementsByTagName("*"),t=0;t<i.length;t++)if("div"==i[t].tagName.toLowerCase()){var s=i[t];return s.style.marginLeft=(this.actualSize.width-300)/2+"px",s.style.marginTop=(this.actualSize.height-250)/2+"px",void(s.firstChild.style.margin="0px")}e.call(this)}.bind(this),100)}).bind(this)()};